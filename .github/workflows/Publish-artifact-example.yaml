---
name: Publish GitHub Actions Artifacts Example

on:
  push:
    branches: [ main]
jobs:
  archive-build-artifacts:
    runs-on: ubuntu-latest
    container:
      image: asciidoctor/docker-asciidoctor
      volumes:
        - ${{ github.workspace }}:/documents
    steps:
      - name: check out the repo
        uses: actions/checkout@v2
      - name: generate pdf
        run: asciidoctor-pdf -a allow-uri-read -r asciidoctor-diagram *adoc
      - uses: benjlevesque/short-sha@v2.1
        id: short-sha
      - name: Create Release
        uses: ncipollo/release-action@v1.12.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}          
        with:
          name: ${{ env.SHA }}
          tag: ${{ env.SHA }}
          makeLatest: true
          removeArtifacts: true
          replacesArtifacts: true
          artifacts: ${{ github.workspace }}/*pdf
      - name: Delete Older Releases
        uses: dev-drprasad/delete-older-releases@v0.2.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          keep_latest: 3
          delete_tags: true
